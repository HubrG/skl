<turbo-frame id="commentFrame">
	<p>
		<i class="fa-regular fa-comments"></i>
		&nbsp;
		<span id="nbrCom">{{ infoChap.publicationChapterComments|length }}</span>
		commentaire(s)<br/><br/>
	</p>
	{% set n = 0 %}
	{% if app.user.id is defined %}
		{% set userLogId = app.user.id %}
	{% else %}
		{% set userLogId = null %}
	{% endif %}
	{% for item in comments|sort((a, b) => a.publishDate > b.publishDate ? -1 : 1) %}
		{% if item.user.id == userLogId %}
			{% set class = "fa-solid fa-heart grayscale cursor-not-allowed text-slate-300 " %}
		{% elseif userLogId %}
			{% set class = "fa-regular fa-heart likeButton cursor-pointer" %}
		{% else %}
			{% set class = "fa-regular fa-heart" %}
		{% endif %}
		{% for itemLike in item.publicationChapterCommentLikes %}
			{% if itemLike.user.id == userLogId %}
				{% set class = "fa-solid fa-heart text-red-500 cursor-pointer likeButton" %}
			{% else %}
				{% set class = "fa-solid fa-heart" %}
			{% endif %}
		{% endfor %}
		<div {% if n == 0 and userLogId == item.user.id and item.publishDate > "now"|date_modify("-2 seconds") %} id="lastComment" class="mb-3  animate__animated animate__fadeIn transition-colors duration-[1000ms] p-6  shadow-sm relative" {% else %} class="bg-white p-6  mb-3  shadow-sm relative" {% endif %}>
			<div class="flex items-start">
				{% set profilPic = asset('images/uploads/profil_pictures/' ~ item.user.id ~ '/' ~ item.user.profilPicture) %}
				<img class="w-12 h-12 rounded-full mr-4" {% if item.user.profilPicture and profilPic|exists %} src="{{ profilPic }}" {% else %} src="https://picsum.photos/200/300" {% endif %} alt="avatar">
				<div class="flex-1">
					<h4 class="font-medium text-sm">
						<a href="{{ path("app_user", {username:item.user.username}) }}">{{ item.user.nickname }}</a>
					</h4>
					<p class="text-gray-600 text-xs">{{ item.publishDate|since }}</p>
				</div>
				<div class="dropdown  dropdown-button ">
					<button class="text-gray-600 hover:text-gray-900 dropdown-button focus:outline-none focus:text-gray-900  ">
						<svg class="w-6 h-6 dropdown-button" fill="currentColor" viewbox="0 0 20 20" id="ddb-{{ item.id }}">
							<path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
						</svg>
					</button>
					<div id="ddm-{{ item.id }}" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dropdown-content">
						<ul class="py-2 text-sm text-gray-700 dark:text-gray-200">
							{% if item.user.id == userLogId %}
								<li>
									<button type="button" id="updateButton-{{ item.id }}" class="updateButton w-full text-left block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
										<i class="fa-regular fa-pen-to-square"></i>
										&nbsp;Modifier</button>
								</li>
								<li>
									<a data-turbo-frame="_self" href="{{ path("app_chapter_del_comment", {id:item.id}) }}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
										<i class="fa-regular fa-trash-can"></i>
										&nbsp;Supprimer</a>
								</li>
							{% else %}
								<li>
									<a data-turbo-frame="_self" href="{{ path("app_chapter_del_comment", {id:item.id}) }}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
										<i class="fa-solid fa-circle-exclamation"></i>
										&nbsp;Signaler un abus</a>
								</li>
							{% endif %}
						</ul>
					</div>
				</div>
			</div>
			<div id="updateCom-{{ item.id }}">
				<p id="comShow-{{ item.id }}" class="chapterComment">
					{{ item.content|nl2br }}
				</p>
			</div>
			{% if item.quote %}
				<blockquote class="mt-4 border-l-4 border-emerald-200 pl-4 italic text-slate-500">
					<p class="font-serif  quoteComment cursor-alias  text-[0.85rem]">{{ item.quote }}</p>
				</blockquote>
			{% endif %}
			<div class="mt-4 flex items-center justify-end">
				<button class="text-gray-600 hover:text-gray-900 focus:outline-none focus:text-gray-900">
					<i class="{{ class }} animate__animated" id="likeButton-{{ item.id }}"></i>
				</button>
				<span class="ml-2 font-medium text-gray-600">
					<span id="nbLikes-{{ item.id }}">{{ item.publicationChapterCommentLikes|length }}</span>
				</span>
			</div>
		</div>
		{% set n = n + 1 %}
	{% endfor %}
	{% if nbrShowCom < infoChap.publicationChapterComments|length %}
		{% if infoPub.slug %}
			{% set chapterSlug = infoPub.slug %}
		{% else %}
			{% set chapterSlug = "feuille-n0" ~ (chapter.orderDisplay + 1) %}
		{% endif %}
		<a href="{{path("app_chapter_show", {user:infoPub.user.id, slug:chapterSlug, slugPub:infoPub.slug, idChap:infoChap.id, nbrShowCom:nbrShowCom + 10})}}">Afficher plus de commentaires</a>
	{% endif %}
</turbo-frame>
