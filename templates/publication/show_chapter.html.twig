{% extends 'base.html.twig' %}

{% block title %}
	{{ infoPub.title ~ ' (' ~ infoChap.title ~ ')' }}
	-
	{{ parent() }}
{% endblock %}

{% block body %}
	<section id="titleChapter" class="sticky top-14 bg-white bg-transparent bg-opacity-50 backdrop-blur-sm">
		<h1>
			<a id="pubTitle" class="dark:text-white" href="{{ path("app_publication_show_one", {id:infoPub.id, slug:infoPub.slug}) }}">{{ infoPub.title }}</a>
		</h1>
		<h2 class="-mt-10 dark:text-white">
			<small>par</small>
			<span class="font-medium dark:text-white">
				<a class="dark:text-white" href="{{ path("app_user", {username:infoPub.user.username}) }}">{{ infoPub.user.nickname }}</a>
			</span>
		</h2>
		<div class="items-center justify-center justify-items-center flex dark:text-white mt-1">
			<button class="text-2xl font-serif -mt-[4rem] text-slate-800 dark:text-white" id="chapListButton" data-dropdown-toggle="dropdownChapter">{{ infoChap.title }}
				<i class="fa-solid fa-chevron-down text-lg"></i>
			</button>
		</div>
		<div id="dropdownChapter" class="z-10 hidden overflow-y-auto max-h-48 bg-white divide-y divide-gray-100 shadow w-2/6 dark:bg-gray-700 dark:divide-gray-600">
			{% for item in infoPub.publicationChapters|sort((a, b) => a.orderDisplay < b.orderDisplay ? -1 : 1) %}
				{% if item.status > 1 %}
					<div>
						<a href="{{ path("app_chapter_show", {idChap:item.id, slugPub:infoPub.slug, user:infoPub.user.username, slug:item.slug}) }}" class="block px-4 py-4 text-sm text-gray-700 {% if item.id == infoChap.id %}bg-slate-50{% endif %} hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">
							{% if item.id == infoChap.id %}
								<i class="fa-solid fa-bookmark"></i>
							{% else %}
								<i class="fa-regular fa-bookmark"></i>
							{% endif %}
							{{ item.title }}
						</a>
					</div>
				{% endif %}
			{% endfor %}
		</div>
	</section>
	<section class="col-span-8 col-start-3 pt-10 row-start-2 backdrop:blur-sm" id="chapContent">
		{% if previousChap %}
			<div class="fixed top-0 w-10 bottom-0 left-0 hidden md:flex items-center justify-start  ml-8 lg:ml-56 z-10" id="arrowPrevious">
				<a href="{{ path("app_chapter_show", {idChap:previousChap.id, slugPub:infoPub.slug, user:infoPub.user.username, slug:previousChap.slug}) }}" class="text-slate-600">
					<i class="fa-solid fa-arrow-left text-4xl"></i>
				</a>
			</div>
		{% endif %}
		<turbo-frame id="chapContentTurbo" class="-z-40">
			<article class="flex flex-col justify-center" id="chapArticle">
				{{ chapterContent|raw }}
			</article>
		</turbo-frame>
		{% if nextChap %}
			<div class="fixed top-0 bottom-0 right-0 hidden md:flex items-center justify-end mr-8 lg:mr-56 " id="arrowNext">
				<a href="{{ path("app_chapter_show", {idChap:nextChap.id, slugPub:infoPub.slug, user:infoPub.user.username, slug:nextChap.slug}) }}" class="text-slate-600  z-10">
					<i class="fa-solid fa-arrow-right font-light  text-4xl"></i>
				</a>
			</div>
		{% endif %}
		<div class="mt-10 flex place-content-between  z-50" id="bottomChap">
			<p class="z-50 w-full md:w-auto">
				{% if previousChap %}
					<a href="{{ path("app_chapter_show", {idChap:previousChap.id, slugPub:infoPub.slug, user:infoPub.user.username, slug:previousChap.slug}) }}" class="ring-1 border-b-2 ring-slate-500 hover:border-slate-900 text-slate-700 font-medium py-2 px-4 text-sm rounded">
						<i class="fa-solid fa-arrow-left"></i>
						Feuille précédente</a>
				{% endif %}
			</p>
			<p class="z-50 w-full md:w-auto">
				{% if nextChap %}
					<a href="{{ path("app_chapter_show", {idChap:nextChap.id, slugPub:infoPub.slug, user:infoPub.user.username, slug:nextChap.slug}) }}" class="ring-1 border-b-2 ring-slate-500 hover:border-slate-900 text-slate-700 font-medium py-2 px-4 text-sm rounded">Feuille suivante
						<i class="fa-solid fa-arrow-right"></i>
					</a>
				{% endif %}
			</p>
		</div>
		<div class="sticky bottom-10 -mt-11 flex  w-full md:w-auto justify-center place-content-center z-10">
			<div class="bg-white rounded-xl shadow p-3 flex gap-5 items-center">
				<div data-tippy-content="Nombre de lecteurs" class="text-sm cursor-default">
					<i class="fa-regular fa-eye"></i>
					&nbsp;{{ infoChap.publicationChapterViews|length }}
				</div>
				|
				<div data-tippy-content="Afficher les commentaires" class="hover:text-blue-600 cursor-pointer text-sm">
					<i class="fa-regular fa-comments toggleSidebar"></i>
					<span id="nbrComSmall" class="toggleSidebar">&nbsp;{{ infoChap.publicationChapterComments|length }}</span>
				</div>
				|
				{% set userLikesChapter = app.user and app.user.id != infoPub.user.id %}
				{% set userCanBookmark = app.user and app.user.id != infoPub.user.id %}

				{% set liked = userLikesChapter ? infoChap.publicationChapterLikes|map(item => item.user.id)|contains(app.user.id) : false %}
				{% set bm = userCanBookmark ? infoChap.publicationChapterBookmarks|map(item => item.user.id)|contains(app.user.id) : false %}

				{% set likeTooltip = app.user is not defined ? "Connectez-vous pour aimer cette feuille !" : infoPub.user.id == app.user.id ? 'Vous ne pouvez pas aimer votre feuille <i class="fa-solid fa-face-smile-beam"></i>' : liked ? "Je n'aime plus cette feuille" : "J'aime cette feuille" %}
				{% set bmTooltip = app.user is not defined ? "Connectez-vous pour marquer cette feuille !" : infoPub.user.id == app.user.id ? 'Vous ne pouvez pas marquer votre feuille <i class="fa-solid fa-face-smile-beam"></i>' : bm ? "Retirer cette feuille de ma collection" : "Ajouter cette feuille à ma collection" %}

				<div class="text-sm {% if userLikesChapter %}hover:text-blue-600 cursor-pointer{% endif %}" id="likeThisChapter" data-tippy-content="{{ likeTooltip }}" data-id="{{ infoChap.id }}">
					<i class="fa-{{ liked ? 'solid text-red-500' : 'regular' }}  fa-heart" id="likeChapterThumb"></i>
					&nbsp;<span id="nbrLike">{{ infoChap.publicationChapterLikes|length }}</span>
				</div>

				<div class="text-sm {% if userCanBookmark %}hover:text-blue-600 cursor-pointer{% endif %}" id="bmThisChapter" data-tippy-content="{{ bmTooltip }}" data-id="{{ infoChap.id }}">
					<i class="fa-{{ bm ? 'solid text-blue-500' : 'regular' }}  fa-bookmark" id="bmChapter"></i>
					&nbsp;<span id="nbrBm">{{ infoChap.publicationChapterBookmarks|length }}</span>
				</div>
			</div>
		</div>
	</section>
	{# TODO: ajouter temps de lecture restant dans le chapitre + temps de lecture total de la publication #}
	<div id="tools" class="hidden">
		<ul>
			<li class="hl" data-color="1">
				<i class="fa-solid fa-bookmark text-emerald-200"></i>
			</li>
			<li class="hl" data-color="2">
				<i class="fa-solid fa-bookmark text-amber-200"></i>
			</li>
			<li class="hl" data-color="3">
				<i class="fa-solid fa-bookmark text-red-200"></i>
			</li>
			<li class="text-slate-400">|</li>
			<li class="commentQuote">
				<i data-tippy-content="Commenter ce passage" class="fa-regular fa-comment toggleSidebar"></i>
			</li>
			<li>
				<i class="fa-solid fa-lock"></i>
			</li>
			<li>|</li>
			<li>
				<i data-tippy-content="Partager sur Twitter" class="shareTwitter  fa-brands fa-square-twitter text-[#1DA1F2]  text-xl"></i>
			</li>
			<li>
				<i data-tippy-content="Partager sur Facebook" class="shareFb fa-brands fa-square-facebook text-[#3b5998]  text-xl"></i>
			</li>
			<li>
				<i data-tippy-content="Partager sur Linkedin" class="shareLk fa-brands fa-linkedin text-[#0072b1] text-xl"></i>
			</li>
			<li>
				<i data-tippy-content="Copier la sélection" class="fa-solid fa-link text-slate-700"></i>
			</li>
		</ul>
	</div>
	<div id="highlighted-options" class="hidden">
		<ul>
			<li>
				<div id="delete-hl">
					<i data-tippy-content="Supprimer le marquage" class="fa-solid fa-xmark"></i>
				</div>
			</li>
			<li class="text-slate-400">|</li>
			<li class="commentAlreadyQuote">
				<i data-tippy-content="Commenter ce passage" class="fa-regular fa-comment toggleSidebar"></i>
			</li>
			<li>
				<i class="fa-solid fa-lock"></i>
			</li>
			<li class="text-slate-400">|</li>
			<li>
				<i data-tippy-content="Partager sur Twitter" class="shareTwitter  fa-brands fa-square-twitter text-[#1DA1F2]  text-xl cursor-pointer"></i>
			</li>
			<li>
				<i data-tippy-content="Partager sur Facebook" class="shareFb fa-brands fa-square-facebook text-[#3b5998]  text-xl"></i>
			</li>
			<li>
				<i data-tippy-content="Partager sur Linkedin" class="shareLk fa-brands fa-linkedin text-[#0072b1] text-xl"></i>
			</li>
			<li>
				<i data-tippy-content="Copier la sélection" class="fa-solid fa-link text-slate-700"></i>
			</li>
		</ul>
	</div>
	{% include "publication/_partials/_show_drawer.html.twig" with {'type': "bottom"}  %}
	<input type="hidden" id="chapId" value="{{ infoChap.id }}">
{% endblock %}
