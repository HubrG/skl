{% extends 'base.html.twig' %}

{% if category.slug is defined %}
	{% set slugCat = category.slug %}
	{% set slugCatName = category.name %}
{% else %}
	{% set slugCat = "all" %}
	{% set slugCatName = "Tous les récits" %}
{% endif %}
{% block title %}Récits |
	{{ slugCatName }}
	—
	{{ parent() }}
{% endblock %}
{% block body %}
	<section class="col-span-12 mb-10">
		<h1 class="text-center font-serif">{{ slugCatName }}</h1>
	</section>
	{# ! Séparateur de mots clés dans l'URL & page #}
	{% set separator = "—" %}
	{% set separator_d = "——" %}
	<!-- double séparateur -->
	{% set pageAct = app.request.get('_route_params')['page'] %}
	<turbo-frame id="pagination-{{ random(0,999) }}" class="grid col-span-full gap-x-10 container -mt-5 ">
		{% include "publication/_partials/_show_all_keywords.html.twig"  %}
		{# ! Affichage des récits #}
		<section class="col-span-10 -mt-5  contrast-100 hue-rotate-15" style="--animate-duration: 1s;">
			<div class="flex mb-10 justify-center gap-7 ">
				<h4 class="w-4/6 mb-5 font-light text-lg text-slate-500">{{ count }}
					récits</h4>
				<div class="-mt-3 -ml-2 items-end">
					<button id="sortButton" data-dropdown-toggle="sortHover" data-dropdown-trigger="hover" class="text-slate-500 ring-1  grayscale ring-slate-300 bg-none hover:bg-blue-100 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2.5 text-center inline-flex  dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
						Organiser par
						<svg class="w-4 h-4 ml-2" aria-hidden="true" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
						</svg>
					</button>
					<!-- Dropdown menu -->
					<div id="sortHover" class="z-10 hidden bg-white divide-y divide-slate-100 rounded-lg shadow w-auto dark:bg-slate-700  grayscale">
						<ul class="py-2 text-sm text-slate-700 dark:text-slate-200" aria-labelledby="sortButton">
							<li>
								<a href="{{ path("app_publication_show_all_category", {slug:slugCat, keystring:kwString, page:page, order:"desc"}) }}" class="block px-4 py-2 hover:text-slate-700 {% if orderSort == " desc" %} bg-slate-100 hover:bg-slate-100{% else %} hover:bg-slate-50{% endif %} dark:hover:bg-slate-600 dark:hover:text-white">Récits les plus
									<strong>récents</strong>
									d'abord
								</a>
							</li>
							<li>
								<a href="{{ path("app_publication_show_all_category", {slug:slugCat, keystring:kwString, page:page, order:"asc"}) }}" class="block px-4 py-2 hover:text-slate-700 {% if orderSort == " asc" %} bg-slate-100  hover:bg-slate-100{% else %} hover:bg-slate-50{% endif %}  dark:hover:bg-slate-600 dark:hover:text-white">Récits les plus
									<strong>anciens</strong>
									d'abord
								</a>
							</li>
						</ul>
						<div class="py-2">
							<a href="#" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:hover:bg-slate-600 dark:text-slate-200 dark:hover:text-white">Separated link</a>
						</div>
					</div>
				</div>
				<div class="-mt-3 -mr-5">
					{% if countPage > 1 %}
						{% include "publication/_partials/_show_all_pagination.html.twig" with {'type': "top"}  %}
					{% endif %}
				</div>
			</div>
			<div class=" flex-col grid-cols-2 gap-3 grid row-span-full  items-stretch animate__animated animate__fadeIn">
				{% for item in pubShow %}
					<div class=" rounded-lg   dark:border-slate-700 flex place-content-start">
						<div class="w-2/6  h-auto rounded-lg">
							<a href="{{ path("app_publication_show_one", {id:item.id, slug:item.slug}) }}">
								<img class="rounded object-cover w-full shaow-md lazy animate-pulse animate__animated bg-slate-300 grayscale-0" loading="lazy" src="" data-src="{{ "https://picsum.photos/200/" ~ random(300, 310) }}" alt=""/>
							</a>
						</div>
						<div class="p-5 -mt-7 w-4/6 place-content-baseline items-baseline">
							<small class="font-light">
								<a href="{{ path("app_user", {username:item.user.username}) }}">{{ item.user.nickname }}</a>
							</small>
							<h5 class="mb-2 text-base font-bold tracking-tight ">
								<a href="{{ path("app_publication_show_one", {id:item.id, slug:item.slug}) }}" class=" text-slate-700  dark:text-white ">{{ item.title }}</a>
							</h5>
							<p class="text-xs -mt-2 mb-2 text-slate-500 font-base">{{ item.publicationChapters|chapter("nbr", "ft") }}
								|
								{{ item.publicationChapters|chapter("rt", "ft") }}
								de lecture</p>
							<p class="mb-3 font-normal text-slate-800 text-sm text-justify  dark:text-slate-400">
								{% if item.summary %}
									{{ item.summary|slice(0, 210) }}
								{% else %}
									{% set nbr = 0 %}
									{% for chap in item.publicationChapters %}
										{% if nbr == 0 %}
											{{ chap.content|striptags|slice(0, 210) }}...
											{% set nbr = nbr + 1 %}
										{% endif %}
									{% endfor %}
								{% endif %}
								<br/>

							</p>
							<p class=" text-cyan-600">
								{% if slugCat == "all" %}
									<span class="bg-blue-100 text-blue-500 text-xs font-medium mr-1 leading-7 mb-2 px-2.5 py-0.5 rounded dark:bg-slate-700 dark:text-slate-400 ">{{ item.category.name|lower }}</span>
								{% endif %}
								{% for pubKeyw in item.publicationKeywords %}
									<span class="bg-slate-100 text-slate-600 text-xs font-medium mr-1 leading-7 mb-2 px-2.5 py-0.5 rounded dark:bg-slate-700 dark:text-slate-400 ">{{ pubKeyw.keyword|lower }}
										{% if not loop.last %}{% endif %}
									</span>
								{% endfor %}
							</p>
						</div>
					</div>
				{% endfor %}
				{% set placeholderimg = "https://via.placeholder.com/200x300" %}
				{% if kwString is null and page == 1 %}
					{% for i in count..limit-1 %}
						<div class=" rounded-lg   dark:border-slate-700 flex place-content-start opacity-80">
							<p class="absolute z-50 ml-[13%] mt-[10%]">
								<a href="{{path("app_publication_add")}}" class=" text-slate-800  rounded  bg-white px-4 shadow-sm bg-opacity-80  p-3 font-medium">
									<i class="fa-solid fa-pen-nib"></i>
									&nbsp;Publier un nouveau récit</a>
							</p>
							<div class="w-2/6  h-auto rounded-lg">
								<a href="{{path("app_publication_add")}}">
									<img class="rounded object-cover w-full shaow-md lazy animate-pulse animate__animated bg-slate-300 grayscale-0  blur-[2px]" loading="lazy" src="" data-src="{{placeholderimg}}" alt=""/>
								</a>
							</div>
							<div class="p-5 -mt-7 w-4/6 place-content-baseline items-baseline  blur-[2px]">
								<small class="font-light">
									<a href="{{path("app_publication_add")}}">
										{% if app.user.id is defined %}
											{{app.user.nickname}}
										{% else %}
											Mon nom d'auteur
										{% endif %}
									</a>
								</small>
								<h5 class="mb-2 text-base font-bold tracking-tight  blur-[2px]">
									<a href="{{path("app_publication_add")}}" class=" text-slate-700  dark:text-white ">{{ "title"|faker(4) }}</a>
								</h5>
								<p class="mb-3 font-normal text-slate-400 text-sm text-justify  dark:text-slate-400 blur-[2px]">
									Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Donec velit neque, auctor sit amet aliquam vel, ullamcorper sit amet ligula. Curabitur aliquet quam id dui posuere blandit. Quisque velit nisi, pretium ut lacinia in, elementum id enim.
								</p>
							</div>
						</div>
					{% endfor %}
				{% endif %}
			</div>
		</section>
		<div class="col-span-12  pt-20 flex justify-center">
			{% if countPage > 1 %}
				{% include "publication/_partials/_show_all_pagination.html.twig" with {'type': "bottom"}  %}
			{% endif %}
		</div>
	</turbo-frame>
{% endblock %}
