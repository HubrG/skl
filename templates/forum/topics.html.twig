{% extends 'base.html.twig' %}

{% block title %}
	{{category.name}}
	| Discuter — Scrilab
{% endblock %}

{% block body %}
	<div class="lg:w-9/12 mx-auto">
		<nav class="breadcrumb" aria-label="Breadcrumb">
			<ol>

				<li>
					<i class="fa-regular fa-comments"></i>
					<a href="{{path("app_forum")}}">
						Discuter
					</a>
				</li>
				<li aria-current="page">
					<div>
						<i class="fa-duotone fa-angle-right"></i>
						<div class="flex flex-row gap-x-0 items-center">
							<i class="fa-regular {{category.icon}}"></i>
							<span>
								{{category.name}}
							</span>
						</div>
					</div>
				</li>
			</ol>
		</nav>
		<div class="flex flex-col mx-auto justify-center w-full -mt-10 relative">
			<div class=" bg-white dark:bg-slate-800 z-50">
				<div class="p-10 py-7 bg-slate-50 dark:bg-slate-900 rounded-lg rounded-b-none flex flex-col w-full">
					<div class="flex flex-row gap-x-10 items-center">
						<div class="min-w-[3rem] md:min-w-[4.8rem] dark:grayscale-[40%] ">
							<div class="rounded-full p-2 md:p-5 catColor-{{category.color ? category.color}}  icon-topic text-lg md:text-xl font-semibold w-full flex justify-center">
								<i class="fa-duotone {{category.icon}} text-2xl md:text-4xl catColorText-{{category.color ? category.color}} dark:text-slate-300"></i>
							</div>
						</div>
						<div class="flex flex-col w-full gap-y-1 dark:text-slate-300">
							<h2 class="text-base flex md:flex-row flex-col justify-between gap-x-2 items-baseline relative">
								<span class=" text-lg md:text-xl font-semibold ">{{category.name}}</span>
								<span class="text-xs  opacity-60">
									<i class="fa-regular fa-layer-group {{category.forumTopics|length == 0 ? " hidden" }}"></i>
									{{category.forumTopics|length == 0 ? "Aucun sujet" : category.forumTopics|length == 1 ? "1 sujet" : category.forumTopics|length ~ " sujets"}}
								</span>
							</h2>
							<p class="dark:text-slate-400">{{category.description|striptags}}</p>
						</div>
					</div>
				</div>
			</div>
			{% if app.user %}
				<a href="{{path("app_forum_topic_create", {slug:category.slug})}}" class=" catColor-{{category.color}} grayscale-[35%] dark:grayscale-[60%] button-classic opacity-100  button-create-topic sticky md:top-16 top-14">
					<span>
						<i class="fa-regular  fa-plus-square"></i>&nbsp;&nbsp;Créer un nouveau sujet sur
						<span class="font-semibold ">
							{{category.name}}
						</span>
					</span>
				</a>
			{% else %}
				<button class="button-classic catColor-{{category.color}} grayscale-[35%] dark:grayscale-[60%] button-create-topic w-full  sticky md:top-16  top-14" data-micromodal-trigger="popup-login">
					<span>
						<i class="fa-regular  fa-plus-square"></i>&nbsp;&nbsp;Créer un nouveau sujet sur
						<span class="font-semibold ">
							{{category.name}}
						</span>
					</span>
				</button>
			{% endif %}
			<div class="border-b-4 w-full border-slate-300 dark:bg-slate-800 bg-white dark:border-slate-700 h-5 bg-opacity-90 dark:bg-opacity-90">&nbsp;</div>
			{% if topics|length == 0 %}
				<h2 class="p-10 text-center text-lg md:w-4/6 w-full mx-auto dark:text-slate-400 text-slate-500 flex flex-col gap-y-2">
					<i class="fa-duotone fa-comment-slash text-3xl"></i>
					Aucun sujet de discussion n'a encore été créé ! Vous avez l'occasion unique d'être la première personne à initier un sujet dans cette catégorie.
				</h2>
			{% else %}
				<div class="flex flex-col  gap-y-5  mt-7">
					{% for item in topics %}
						<div class="flex flex-row  gap-x-3 pl-2  items-center justify-between">
							<div class="flex-shrink-0 w-12 h-12">
								{% if item.user.profilPicture %}
									<img src="{{item.user.profilPicture}}" class="h-full w-full rounded-full self-start" alt="Photo de profil de {{item.user.nickname}}">
								{% else %}
									<div class="rounded-full bg-slate-300 h-full w-full dark:bg-slate-700 flex justify-center items-center text-slate-500 dark:text-slate-300 text-2xl font-semibold">
										{{item.user.nickname|first}}
									</div>
								{% endif %}
							</div>
							<div class="flex flex-col gap-y-0 w-9/12">
								<span>
									{% if item.permanent > 0 %}
										<span class="catColor-{{category.color}} text-[0.75rem] font-medium px-2 py-1 pb-0 inline-flex -mt-1 self-center rounded" data-tippy-content="Sujet épinglé">
											<i class="fa-regular fa-thumbtack"></i>
										</span>
										&nbsp;&nbsp;
									{% endif %}
									<a href="{{path("app_forum_topic_read", {slug:item.category.slug, slugTopic:item.slug, id:item.id})}}" class="hover:underline text-base font-semibold dark:text-slate-300">
										{{item.title}}
									</a>
								</span>
								<p class="flex flex-col items-baseline justify-start gap-x-2">
									<a href="{{path("app_user", {username:item.user.username})}}" class="hover:underline dark:text-slate-500 text-slate-500">
										{{item.user.nickname}}
									</a>
									<span class="text-[0.75rem] text-slate-500 flex md:flex-row flex-col md:justify-between justify-start text-left items-center w-full">
										<span class="self-start order-1">
											Crée il y a
											{{item.createdAt|since}}
										</span>
										<span class="md:self-end self-start order-3  {{item.forumMessages|length == 0 ? " hidden" }}">
											Dernière réponse il y a
											{% set lastMessage = item.forumMessages|last %}
											{{lastMessage ? lastMessage.publishedAt|since : item.createdAt|since }}
										</span>
										{% if item.updatedAt %}
											<span class="md:self-center order-2 self-start">
												Modifié il y a
												{{item.updatedAt|since}}
											</span>
										{% endif %}
									</p>
								</p>
							</span>
						</p>
					</div>
					<div class="grid grid-cols-3  text-sm items-center gap-x-5">
						<div class="flex flex-col items-center">
							<span class="dark:text-slate-500 text-slate-500">
								<i class="fa-duotone  fa-comment-alt" data-tippy-content="Nombre de réponses"></i>
							</span>
							<span class="dark:text-slate-500 text-slate-500 ">{{item.forumMessages|length}}</span>
						</div>
						<div class="flex flex-col items-center">
							<span class="dark:text-slate-500 text-slate-500">
								<i class="fa-duotone fa-eye" data-tippy-content="Nombre de vues"></i>
							</span>
							<span class="dark:text-slate-500 text-slate-500 ">{{item.forumTopicViews|length}}</span>
						</div>
						{% if app.user %}
							<div class="flex flex-col items-center {{unreadMessageCounts[item.id] > 0 ? " dark:text-green-500 text-green-500 " : " dark:text-slate-500 text-slate-500 opacity-30"}}">
								<span>
									<i class="fa-duotone fa-comment-dots" data-tippy-content="Nouveaux messages depuis votre dernière visite"></i>
								</span>
								<span>{{ unreadMessageCounts[item.id] }}</span>
							</div>
						{% endif %}
					</div>
				</div>
				<hr class="my-2">
			{% endfor %}
		</div>
	{% endif %}
</div></div>{% endblock %}
