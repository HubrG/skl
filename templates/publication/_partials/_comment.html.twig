{% set userLogId = app.user.id is defined ? app.user.id : null %}
{% set class = "material-symbols-outlined" %}
{% if userLogId is not null %}
	{% if item.user.id == userLogId %}
		{% set class = "material-icons grayscale cursor-not-allowed text-slate-300 " %}
	{% else %}
		{% for itemLike in item.publicationCommentLikes %}
			{% if itemLike.user.id == app.user.id %}
				{% set class = "material-icons text-red-500 cursor-pointer likeButton  dark:text-red-400" %}
				{% set liked = true %}
				{% set break = "" %}
			{% else %}
				{% set liked = false %}
			{% endif %}
		{% endfor %}
		{% if liked is defined %}
			{% set class = "material-symbols-outlined likeButton cursor-pointer dark:text-red-400" %}
		{% endif %}
		{% if class == "material-symbols-outlined" %}
			{% set class = "material-symbols-outlined likeButton cursor-pointer dark:text-red-400 " %}
		{% endif %}
	{% endif %}
{% else %}
	{% set class = "material-symbols-outlined cursor-default text-slate-400  dark:text-red-400" %}
{% endif %}
{% set lastComment = n == 0 and userLogId == item.user.id and item.publishedAt > "now"|date_modify("-2 seconds") %}
{% if n == 0 %}
	<p class="dark:text-white">
		<span class="material-symbols-outlined">
			question_answer
		</span>
		&nbsp;
		{% set nbComment = pcom %}
		{% if nbComment == 0 %}
			Aucun commentaire
			<span class="nbr-com" class="hidden">{{ nbComment }}</span>
		{% else %}
			<span class="nbr-com" id="nbr-com">{{ nbComment }}</span>
			{% if nbComment > 1 %}
				commentaires
			{% else %}
				commentaire
			{% endif %}
		{% endif %}
		<br/><br/>
	</p>
{% endif %}
<div id="comment-{{item.id}}">
	<div class="one-comment rounded {{ lastComment ? 'mb-3 animate__animated animate__fadeIn transition-colors duration-[1000ms] p-6 shadow-sm relative' : 'bg-white dark:bg-slate-900 p-6 mb-3 shadow-sm relative' }}" {% if lastComment %} id="lastComment" {% endif %}>
		<div class="flex items-start">
			{% set profilPic = item.user.profilPicture ? item.user.profilPicture : 'https://picsum.photos/200/300' %}
			<img class="w-12 h-12 rounded-full mr-4" src="{{ profilPic }}" alt="avatar">
			<div class="flex-1">
				<h4 class="font-medium text-sm dark:text-white">
					<a href="{{ path("app_user", {username:item.user.username}) }}" class="hover:underline">{{ item.user.nickname }}</a>
				</h4>
				<p class="text-slate-600 text-xs dark:text-white">
					{{ item.publishedAt|since }}
					<span class="text-gray-400 text-[0.70rem]">{{item.updatedAt ? "| modifi√© il y a " ~ item.updatedAt|since}}</span>
				</p>
			</div>
			{% if userLogId is not null %}
				<div class="dropdown">
					<button class="text-gray-600 hover:text-gray-900   focus:outline-none focus:text-gray-900">
						<svg class="w-6 h-6 dropdown-button " fill="currentColor" viewbox="0 0 20 20" id="ddb-{{ item.id }}">
							<path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
						</svg>
					</button>
					<div id="ddm-{{ item.id }}" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dropdown-content">
						<ul class="py-2 text-sm text-gray-700 dark:text-gray-200">
							{% if item.user.id == userLogId %}
								<li>
									<button type="button" data-update-path="{{path("app_comment_update")}}" id="updateButton-{{ item.id }}" class="updateButton w-full text-left block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
										<span class="material-symbols-outlined">
											edit_note
										</span>
										&nbsp;Modifier
									</button>
								</li>
								<li>
									<button data-delete-path="{{path("app_comment_delete")}}" data-comment-id="{{item.id}}" class="updateButton w-full text-left block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white deleteCommentButton">
										<span class="material-symbols-outlined">
											delete
										</span>
										&nbsp;Supprimer
									</button>
								</li>
							{% else %}
								<li>
									<a data-turbo-frame="_self" href="{{path("app_comment_delete")}}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
										<span class="material-symbols-outlined">
											report
										</span>
										&nbsp;Signaler
									</a>
								</li>
							{% endif %}
						</ul>
					</div>
				</div>
			{% endif %}
		</div>
		<div id="updateCom-{{ item.id }}">
			<p id="comShow-{{ item.id }}" class="chapterComment dark:text-slate-200">
				{{ item.content|nl2br }}
			</p>
		</div>
		{% if item.quote %}
			<blockquote class="mt-4 border-l-4 border-emerald-200 pl-4 italic text-slate-500">
				<p class="font-serif quoteComment cursor-alias text-[0.85rem]">{{ item.quote }}</p>
			</blockquote>
		{% endif %}
		<div class="mt-4 flex items-center justify-end">
			<span class="{{ class }} animate__animated" id="likeButton-{{ item.id }}" data-like-path="{{path("app_comment_like")}}">favorite</span>
			<span class="ml-2 font-medium text-gray-600">
				<span id="nbLikes-{{ item.id }}">{{ item.publicationCommentLikes|length }}</span>
			</span>
		</div>
	</div>
</div>
